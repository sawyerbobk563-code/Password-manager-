<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShieldVault | Zero-Knowledge Password Manager</title>
    
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" id="manifest-link">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }
        
        .glass-card-dark {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .hidden-vault { 
            display: none; 
        }
        
        .entry-card { 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        .entry-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }
        
        .password-field {
            font-family: 'Courier New', monospace;
        }
        
        .floating-button {
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .3s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4f46e5;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .theme-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
        }
        
        .theme-dark .glass-card {
            background: rgba(30, 41, 59, 0.85);
            color: #f8fafc;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .theme-dark .text-slate-800 {
            color: #f1f5f9;
        }
        
        .theme-dark .text-slate-700 {
            color: #e2e8f0;
        }
        
        .theme-dark .text-slate-600 {
            color: #cbd5e1;
        }
        
        .theme-dark .text-slate-500 {
            color: #94a3b8;
        }
        
        .theme-dark .text-slate-400 {
            color: #64748b;
        }
        
        .theme-dark .bg-slate-100 {
            background-color: rgba(30, 41, 59, 0.7);
        }
        
        .theme-dark .border-slate-200 {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .theme-dark input, .theme-dark select {
            background-color: rgba(15, 23, 42, 0.7);
            color: #f8fafc;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .theme-dark input::placeholder {
            color: #94a3b8;
        }
        
        .theme-dark .bg-white {
            background-color: rgba(30, 41, 59, 0.9);
        }
        
        .theme-dark .shadow-sm {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .theme-dark .shadow-md {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .theme-dark .shadow-lg {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        
        .theme-dark .shadow-xl {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }
        
        .copy-success {
            animation: copyPulse 0.5s ease;
        }
        
        @keyframes copyPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @media (min-width: 768px) {
            .split-layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px;
            }
            
            #app {
                max-width: 1200px;
            }
            
            .fixed-bottom-wide {
                left: 50%;
                transform: translateX(-50%);
                width: 100%;
                max-width: 1200px;
            }
        }
        
        .tutorial-step {
            position: relative;
            z-index: 100;
        }
        
        .highlight {
            animation: highlight 2s ease-in-out;
        }
        
        @keyframes highlight {
            0%, 100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
            50% { box-shadow: 0 0 0 10px rgba(79, 70, 229, 0.2); }
        }
        
        /* Info Modal Styles */
        .info-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .password-criteria-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        
        .criteria-met {
            color: #10b981;
        }
        
        .criteria-not-met {
            color: #ef4444;
        }
        
        /* New Styles for Added Features */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }
        
        .notification {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4f46e5;
            animation: slideInRight 0.3s ease-out;
            transform: translateX(0);
        }
        
        .notification-success {
            border-left-color: #10b981;
        }
        
        .notification-warning {
            border-left-color: #f59e0b;
        }
        
        .notification-error {
            border-left-color: #ef4444;
        }
        
        .notification-info {
            border-left-color: #3b82f6;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .tab-button {
            padding: 10px 20px;
            border-radius: 8px 8px 0 0;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-bottom: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: white;
            color: #4f46e5;
        }
        
        .theme-dark .tab-button {
            background: rgba(30, 41, 59, 0.5);
            color: #f1f5f9;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .theme-dark .tab-button.active {
            background: rgba(30, 41, 59, 0.9);
            color: #4f46e5;
        }
        
        .notes-editor {
            min-height: 200px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            background: white;
            font-family: 'Inter', sans-serif;
        }
        
        .theme-dark .notes-editor {
            background: rgba(15, 23, 42, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
        }
        
        .pwned-status-safe {
            color: #10b981;
        }
        
        .pwned-status-compromised {
            color: #ef4444;
        }
        
        .logout-warning-modal {
            background: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body class="min-h-screen font-sans">
    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Logout Warning Modal -->
    <div id="logout-warning-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden logout-warning-modal">
        <div class="glass-card w-full max-w-md mx-4 p-8 rounded-2xl relative">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-clock text-3xl text-amber-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">Session Timeout Warning</h2>
                <p class="text-slate-600 mt-2">You will be logged out due to inactivity in</p>
                <div class="text-4xl font-bold text-amber-600 my-4" id="countdown-timer">60</div>
                <p class="text-slate-500 text-sm">Move your mouse or press any key to continue your session</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="extendSession()" class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition">
                    <i class="fas fa-sync-alt mr-2"></i>Stay Logged In
                </button>
                <button onclick="confirmLogout()" class="flex-1 bg-slate-100 text-slate-700 font-semibold py-3.5 rounded-xl hover:bg-slate-200 transition">
                    <i class="fas fa-sign-out-alt mr-2"></i>Log Out Now
                </button>
            </div>
        </div>
    </div>

    <!-- Have I Been Pwned Modal -->
    <div id="pwned-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card w-full max-w-md mx-4 p-6 rounded-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-800">Password Security Check</h3>
                <button onclick="closePwnedModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-5">
                <div class="bg-slate-50 p-4 rounded-xl">
                    <p class="text-sm text-slate-600 mb-3">
                        Check if your password has been exposed in data breaches using the 
                        <a href="https://haveibeenpwned.com/Passwords" target="_blank" class="text-indigo-600 hover:underline">Have I Been Pwned</a> 
                        service. This check uses k-anonymity to protect your password.
                    </p>
                    <div class="relative">
                        <input type="password" id="pwned-password" placeholder="Enter password to check" class="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none password-field">
                        <button onclick="togglePasswordVisibility('pwned-password')" class="absolute right-3 top-3 text-slate-400 hover:text-slate-600">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 mt-2">
                        <i class="fas fa-shield-alt mr-1"></i>
                        Your password is never sent in full to the API
                    </p>
                </div>
                
                <div id="pwned-result" class="hidden">
                    <div class="p-4 rounded-xl" id="pwned-result-content">
                        <!-- Results will appear here -->
                    </div>
                </div>
                
                <div class="flex gap-3 pt-2">
                    <button onclick="checkPwnedPassword()" id="check-pwned-btn" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:opacity-90 transition">
                        <i class="fas fa-search mr-2"></i>Check Password
                    </button>
                    <button onclick="closePwnedModal()" class="flex-1 bg-slate-100 text-slate-700 font-semibold py-3 rounded-xl hover:bg-slate-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Button -->
    <button id="info-button" onclick="showInfoModal()" class="fixed bottom-24 right-6 z-40 w-12 h-12 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center">
        <i class="fas fa-info text-lg"></i>
    </button>

    <!-- Info Modal -->
    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card w-full max-w-2xl mx-4 p-8 rounded-2xl relative info-modal-content">
            <button onclick="closeInfoModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-xl">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-shield-alt text-3xl text-indigo-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">About ShieldVault</h2>
                <p class="text-slate-600 mt-2">Zero-Knowledge Password Manager</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="font-semibold text-slate-800 text-lg mb-2">How It Works</h3>
                    <p class="text-slate-600 text-sm">
                        ShieldVault uses zero-knowledge encryption, meaning your master password and encrypted data never leave your device. 
                        Your passwords are encrypted locally using AES-GCM 256-bit encryption before being synced to the cloud.
                        Only you can decrypt your data with your master password.
                    </p>
                </div>
                
                <div>
                    <h3 class="font-semibold text-slate-800 text-lg mb-2">Security Features</h3>
                    <ul class="text-slate-600 text-sm space-y-2">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>End-to-end encryption (AES-GCM 256-bit)</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Zero-knowledge architecture</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Client-side encryption & decryption</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Secure password generator</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Password strength analysis</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Have I Been Pwned password checker</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Auto-logout after inactivity</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-500 mt-0.5"></i>
                            <span>Secure notes with encryption</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-slate-800 text-lg mb-2">What Makes a Strong Password?</h3>
                    <div class="text-slate-600 text-sm space-y-3">
                        <div class="password-criteria-item">
                            <i class="fas fa-check-circle criteria-met"></i>
                            <span><strong>Length:</strong> At least 12 characters (preferably 16+)</span>
                        </div>
                        <div class="password-criteria-item">
                            <i class="fas fa-check-circle criteria-met"></i>
                            <span><strong>Complexity:</strong> Mix of uppercase, lowercase, numbers, and symbols</span>
                        </div>
                        <div class="password-criteria-item">
                            <i class="fas fa-check-circle criteria-met"></i>
                            <span><strong>Uniqueness:</strong> Different password for each account</span>
                        </div>
                        <div class="password-criteria-item">
                            <i class="fas fa-times-circle criteria-not-met"></i>
                            <span><strong>Avoid:</strong> Dictionary words, personal information, common patterns</span>
                        </div>
                        <div class="password-criteria-item">
                            <i class="fas fa-times-circle criteria-not-met"></i>
                            <span><strong>Avoid:</strong> Password reuse across multiple sites</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-indigo-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-indigo-800 text-lg mb-2">Having Problems?</h3>
                    <p class="text-indigo-700 text-sm">
                        Contact support: 
                        <a href="mailto:sawyerbobk563@gmail.com" class="font-medium underline hover:text-indigo-900">
                            sawyerbobk563@gmail.com
                        </a>
                    </p>
                    <p class="text-indigo-600 text-xs mt-2">
                        For security reasons, we cannot recover your master password if you forget it. 
                        Please ensure you remember it or store it in a secure location.
                    </p>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-200">
                <button onclick="closeInfoModal()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Welcome Tutorial Modal -->
    <div id="tutorial-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card w-full max-w-2xl mx-4 p-8 rounded-2xl relative">
            <button onclick="closeTutorial()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-xl">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-graduation-cap text-3xl text-indigo-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">Welcome to ShieldVault!</h2>
                <p class="text-slate-600 mt-2">Let's get you started with your secure password manager</p>
            </div>
            
            <div class="space-y-6">
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-indigo-600 font-bold">1</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Add Your First Password</h3>
                        <p class="text-slate-600 text-sm mt-1">Use the form on the left to add your first password entry. All data is encrypted before it leaves your device.</p>
                    </div>
                </div>
                
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-indigo-600 font-bold">2</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Use the Password Generator</h3>
                        <p class="text-slate-600 text-sm mt-1">Click the key icon to generate strong, unique passwords for each account.</p>
                    </div>
                </div>
                
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-indigo-600 font-bold">3</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Save to Cloud</h3>
                        <p class="text-slate-600 text-sm mt-1">Click "Save to Cloud" to securely sync your encrypted vault. Your master password is never stored.</p>
                    </div>
                </div>
                
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-indigo-600 font-bold">4</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Export & Backup</h3>
                        <p class="text-slate-600 text-sm mt-1">Use the Export buttons to create JSON or CSV backups of your vault for safekeeping.</p>
                    </div>
                </div>
                
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-indigo-600 font-bold">5</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Secure Notes</h3>
                        <p class="text-slate-600 text-sm mt-1">Switch to the Secure Notes tab to store encrypted notes that sync to the cloud.</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-200">
                <div class="flex items-center justify-center gap-2 text-sm text-slate-500">
                    <input type="checkbox" id="dont-show-again" class="rounded">
                    <label for="dont-show-again">Don't show this tutorial again</label>
                </div>
                
                <button onclick="closeTutorial()" class="w-full mt-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition">
                    Get Started
                </button>
            </div>
        </div>
    </div>

    <div id="app" class="max-w-6xl mx-auto pt-6 pb-32 px-4">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-indigo-600 tracking-tight flex items-center gap-2">
                    <i class="fas fa-shield-alt"></i>
                    <span>ShieldVault</span>
                </h1>
                <p class="text-slate-500 text-sm">Zero-Knowledge Password Manager</p>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs text-slate-400">Dark</span>
                <label class="switch">
                    <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Auth Section -->
        <div id="auth-section" class="glass-card p-8 rounded-2xl shadow-xl fade-in max-w-md mx-auto">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-lock text-2xl text-indigo-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">Unlock Your Vault</h2>
                <p class="text-slate-500 text-sm mt-1">Access your encrypted passwords</p>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Vault Name</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-3.5 text-slate-400"></i>
                        <input type="text" id="username" class="w-full pl-10 p-3.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="e.g. my-private-vault">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Master Password</label>
                    <div class="relative">
                        <i class="fas fa-key absolute left-3 top-3.5 text-slate-400"></i>
                        <input type="password" id="master-password" class="w-full pl-10 p-3.5 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="Keep this safe!">
                        <button onclick="togglePasswordVisibility('master-password')" class="absolute right-3 top-3.5 text-slate-400 hover:text-slate-600">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <p class="text-xs text-slate-400 mt-2 flex items-center gap-1">
                        <i class="fas fa-info-circle"></i>
                        Your password is never sent to our servers
                    </p>
                </div>
                <button onclick="unlockVault()" id="unlock-btn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition-all active:scale-98 shadow-lg shadow-indigo-200 flex items-center justify-center gap-2">
                    <i class="fas fa-unlock-alt"></i>
                    <span>Access Vault</span>
                </button>
                
                <!-- Have I Been Pwned Button -->
                <div class="pt-4">
                    <button onclick="openPwnedModal()" class="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition-all active:scale-98 shadow-lg shadow-blue-200 flex items-center justify-center gap-2">
                        <i class="fas fa-search"></i>
                        <span>Check Password Security</span>
                    </button>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-100">
                <p class="text-xs text-slate-500 text-center">New user? Just enter a vault name and password to create one.</p>
            </div>
        </div>

        <!-- Vault Section -->
        <div id="vault-section" class="hidden-vault">
            <!-- Vault Header -->
            <div class="glass-card p-5 rounded-2xl shadow-md flex justify-between items-center slide-up mb-6">
                <div>
                    <p class="text-xs uppercase font-semibold text-slate-400 flex items-center gap-1">
                        <i class="fas fa-vault"></i>
                        Active Vault
                    </p>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="font-bold text-indigo-600 text-lg" id="display-user"></span>
                        <div class="text-xs px-2 py-0.5 bg-emerald-100 text-emerald-800 rounded-full font-medium">
                            <i class="fas fa-check-circle mr-1"></i>
                            <span id="entry-count">0</span> passwords
                        </div>
                        <div class="text-xs px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full font-medium">
                            <i class="fas fa-sticky-note mr-1"></i>
                            <span id="notes-count">0</span> notes
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="text-xs text-slate-500 hidden md:block">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Last sync: <span id="last-sync-time">Never</span>
                    </div>
                    <div class="text-xs text-amber-600 hidden md:block" id="inactivity-timer">
                        <i class="fas fa-clock mr-1"></i>
                        Auto-logout: 5:00
                    </div>
                    <button onclick="confirmLockVault()" class="bg-slate-100 text-slate-700 px-4 py-2 rounded-lg font-medium hover:bg-red-50 hover:text-red-600 transition flex items-center gap-2">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Lock Vault</span>
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-1 mb-6">
                <button id="tab-passwords" class="tab-button active" onclick="switchTab('passwords')">
                    <i class="fas fa-key mr-2"></i>Passwords
                </button>
                <button id="tab-notes" class="tab-button" onclick="switchTab('notes')">
                    <i class="fas fa-sticky-note mr-2"></i>Secure Notes
                </button>
            </div>

            <!-- Password Tab Content -->
            <div id="tab-content-passwords" class="tab-content">
                <!-- Split Layout for Desktop -->
                <div class="split-layout">
                    <!-- Left Column - Add New Entry -->
                    <div class="space-y-6">
                        <!-- Add New Entry -->
                        <div class="glass-card p-6 rounded-2xl shadow-md slide-up">
                            <p class="text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-plus-circle text-indigo-500"></i>
                                Add New Account
                            </p>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-1">Website/App</label>
                                        <input type="text" id="new-site" placeholder="e.g. Google" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-1">Category</label>
                                        <select id="new-category" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition">
                                            <option value="General">General</option>
                                            <option value="Social">Social Media</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Work">Work</option>
                                            <option value="Shopping">Shopping</option>
                                            <option value="Entertainment">Entertainment</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Username/Email</label>
                                    <input type="text" id="new-user" placeholder="username@example.com" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Password</label>
                                    <div class="flex gap-2">
                                        <div class="relative flex-1">
                                            <input type="text" id="new-pass" placeholder="Generate or enter password" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition password-field">
                                            <button onclick="togglePasswordVisibility('new-pass')" class="absolute right-2 top-2.5 text-slate-400 hover:text-slate-600">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="generatePassword()" class="bg-indigo-100 text-indigo-700 px-3 rounded-lg font-medium hover:bg-indigo-200 transition flex items-center" title="Generate Password">
                                                <i class="fas fa-key"></i>
                                            </button>
                                            <button onclick="addEntry()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2.5 rounded-lg font-bold shadow-md hover:opacity-90 transition flex items-center gap-2">
                                                <i class="fas fa-plus"></i>
                                                <span class="hidden sm:inline">Add</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-2">
                                        <div class="text-xs text-slate-400">
                                            Strength: <span id="password-strength" class="font-medium">None</span>
                                        </div>
                                        <button onclick="suggestPassword()" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium">
                                            <i class="fas fa-bolt mr-1"></i>
                                            Suggest Strong Password
                                        </button>
                                    </div>
                                    <!-- Password Criteria -->
                                    <div id="password-criteria" class="mt-2 text-xs space-y-1 hidden">
                                        <div class="flex items-center justify-between">
                                            <span>Length (≥12 chars):</span>
                                            <span id="criteria-length" class="text-red-500">✗</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span>Uppercase letters:</span>
                                            <span id="criteria-uppercase" class="text-red-500">✗</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span>Lowercase letters:</span>
                                            <span id="criteria-lowercase" class="text-red-500">✗</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span>Numbers:</span>
                                            <span id="criteria-numbers" class="text-red-500">✗</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span>Special characters:</span>
                                            <span id="criteria-special" class="text-red-500">✗</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Statistics -->
                        <div class="glass-card p-6 rounded-2xl shadow-md slide-up">
                            <p class="text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-pie text-indigo-500"></i>
                                Enhanced Statistics
                            </p>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="text-xs text-slate-500">Strong Passwords</div>
                                        <div class="text-xl font-bold text-emerald-600" id="stats-strong">0</div>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="text-xs text-slate-500">Weak Passwords</div>
                                        <div class="text-xl font-bold text-red-600" id="stats-weak">0</div>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-slate-600">Average Password Age:</span>
                                        <span class="font-medium text-slate-800" id="stats-age">0 days</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-slate-600">Password Reuse:</span>
                                        <span class="font-medium text-slate-800" id="stats-reuse">0</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-slate-600">Short Passwords (<12 chars):</span>
                                        <span class="font-medium text-slate-800" id="stats-short">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vault Tools -->
                        <div class="glass-card p-6 rounded-2xl shadow-md slide-up">
                            <p class="text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-toolbox text-indigo-500"></i>
                                Vault Tools
                            </p>
                            
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="exportVault('json')" class="bg-white border border-slate-200 py-3 rounded-xl font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2">
                                        <i class="fas fa-file-export text-emerald-600"></i>
                                        Export JSON
                                    </button>
                                    <button onclick="exportVault('csv')" class="bg-white border border-slate-200 py-3 rounded-xl font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2">
                                        <i class="fas fa-file-csv text-blue-600"></i>
                                        Export CSV
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="bg-white border border-slate-200 py-3 rounded-xl font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2 cursor-pointer">
                                        <i class="fas fa-file-import text-amber-600"></i>
                                        Import JSON
                                        <input type="file" id="import-json-file" class="hidden" accept=".json" onchange="importVault(event, 'json')">
                                    </label>
                                    <label class="bg-white border border-slate-200 py-3 rounded-xl font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2 cursor-pointer">
                                        <i class="fas fa-file-import text-purple-600"></i>
                                        Import CSV
                                        <input type="file" id="import-csv-file" class="hidden" accept=".csv" onchange="importVault(event, 'csv')">
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-slate-100">
                                <p class="text-xs text-slate-400 text-center italic flex items-center justify-center gap-1">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Exported files are NOT encrypted. Keep them safe!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Entries List -->
                    <div class="space-y-6">
                        <!-- Search Bar -->
                        <div class="glass-card p-4 rounded-2xl shadow-sm slide-up">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                                <input type="text" id="search-input" onkeyup="searchEntries()" class="w-full pl-10 p-3 rounded-lg border-0 focus:ring-2 focus:ring-indigo-400 outline-none bg-transparent" placeholder="Search passwords...">
                                <button onclick="clearSearch()" id="clear-search" class="absolute right-3 top-3 text-slate-400 hover:text-slate-600 hidden">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="flex justify-between items-center mt-3">
                                <div class="text-xs text-slate-500">
                                    Showing <span id="showing-count">0</span> of <span id="total-count">0</span> passwords
                                </div>
                                <div class="flex gap-2">
                                    <select id="sort-select" onchange="sortEntries(this.value)" class="text-xs text-slate-700 px-2 py-1.5 rounded border border-slate-200 bg-white focus:ring-1 focus:ring-indigo-400 outline-none">
                                        <option value="site-asc">Name (A-Z)</option>
                                        <option value="site-desc">Name (Z-A)</option>
                                        <option value="category">Category</option>
                                        <option value="strength">Password Strength</option>
                                        <option value="recent">Recently Added</option>
                                        <option value="oldest">Oldest First</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Entries List -->
                        <div id="entries-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2"></div>
                        
                        <!-- Empty State -->
                        <div id="empty-state" class="py-16 text-center hidden">
                            <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-lock-open text-3xl text-indigo-400"></i>
                            </div>
                            <h3 class="text-lg font-medium text-slate-700">Your vault is empty</h3>
                            <p class="text-slate-500 text-sm mt-1 max-w-xs mx-auto">Add your first password using the form on the left. Your data is encrypted before it leaves your device.</p>
                            <button onclick="document.getElementById('new-site').focus()" class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-arrow-left"></i>
                                Go to Add Password Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes Tab Content -->
            <div id="tab-content-notes" class="tab-content hidden">
                <div class="split-layout">
                    <!-- Left Column - Add New Note -->
                    <div class="space-y-6">
                        <!-- Add New Note -->
                        <div class="glass-card p-6 rounded-2xl shadow-md slide-up">
                            <p class="text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-plus-circle text-indigo-500"></i>
                                Add New Secure Note
                            </p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Note Title</label>
                                    <input type="text" id="new-note-title" placeholder="e.g. Bank Account Details" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Category</label>
                                    <select id="new-note-category" class="w-full p-2.5 text-sm rounded-lg border border-slate-200 focus:ring-1 focus:ring-indigo-400 outline-none transition">
                                        <option value="Personal">Personal</option>
                                        <option value="Work">Work</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Ideas">Ideas</option>
                                        <option value="Credentials">Credentials</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Note Content</label>
                                    <div class="notes-editor" id="new-note-content" contenteditable="true" placeholder="Type your secure note here..."></div>
                                    <div class="flex justify-between mt-2">
                                        <div class="text-xs text-slate-400">
                                            <i class="fas fa-lock mr-1"></i>
                                            Will be encrypted before saving
                                        </div>
                                        <div class="text-xs text-slate-400">
                                            Characters: <span id="note-char-count">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button onclick="addNote()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3.5 rounded-xl hover:opacity-90 transition flex items-center justify-center gap-2">
                                    <i class="fas fa-save"></i>
                                    <span>Save Secure Note</span>
                                </button>
                            </div>
                        </div>

                        <!-- Notes Statistics -->
                        <div class="glass-card p-6 rounded-2xl shadow-md slide-up">
                            <p class="text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-bar text-indigo-500"></i>
                                Notes Statistics
                            </p>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="text-xs text-slate-500">Total Notes</div>
                                        <div class="text-xl font-bold text-indigo-600" id="stats-notes-total">0</div>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="text-xs text-slate-500">Characters</div>
                                        <div class="text-xl font-bold text-emerald-600" id="stats-notes-chars">0</div>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="text-sm text-slate-600">Categories:</div>
                                    <div id="notes-categories" class="flex flex-wrap gap-2">
                                        <!-- Categories will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Notes List -->
                    <div class="space-y-6">
                        <!-- Notes Search -->
                        <div class="glass-card p-4 rounded-2xl shadow-sm slide-up">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                                <input type="text" id="search-notes-input" onkeyup="searchNotes()" class="w-full pl-10 p-3 rounded-lg border-0 focus:ring-2 focus:ring-indigo-400 outline-none bg-transparent" placeholder="Search notes...">
                                <button onclick="clearNotesSearch()" id="clear-notes-search" class="absolute right-3 top-3 text-slate-400 hover:text-slate-600 hidden">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="flex justify-between items-center mt-3">
                                <div class="text-xs text-slate-500">
                                    Showing <span id="showing-notes-count">0</span> of <span id="total-notes-count">0</span> notes
                                </div>
                                <div class="flex gap-2">
                                    <select id="sort-notes-select" onchange="sortNotes(this.value)" class="text-xs text-slate-700 px-2 py-1.5 rounded border border-slate-200 bg-white focus:ring-1 focus:ring-indigo-400 outline-none">
                                        <option value="title-asc">Title (A-Z)</option>
                                        <option value="title-desc">Title (Z-A)</option>
                                        <option value="date-desc">Newest First</option>
                                        <option value="date-asc">Oldest First</option>
                                        <option value="category">Category</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notes List -->
                        <div id="notes-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2"></div>
                        
                        <!-- Empty Notes State -->
                        <div id="empty-notes-state" class="py-16 text-center hidden">
                            <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-sticky-note text-3xl text-indigo-400"></i>
                            </div>
                            <h3 class="text-lg font-medium text-slate-700">No secure notes yet</h3>
                            <p class="text-slate-500 text-sm mt-1 max-w-xs mx-auto">Add your first secure note using the form on the left. All notes are encrypted before syncing.</p>
                            <button onclick="document.getElementById('new-note-title').focus()" class="mt-4 text-indigo-600 hover:text-indigo-800 font-medium flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-arrow-left"></i>
                                Go to Add Note Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Last Sync Info -->
            <div class="mt-8 text-center">
                <div class="inline-flex items-center gap-2 text-sm text-slate-500 bg-white/50 px-4 py-2 rounded-full">
                    <i class="fas fa-cloud"></i>
                    <span>Last sync: <span id="last-sync-bottom" class="font-medium">Never</span></span>
                    <div class="w-2 h-2 bg-slate-300 rounded-full ml-1" id="sync-status-indicator"></div>
                </div>
            </div>
            
            <!-- Floating Sync Button -->
            <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-6xl px-4">
                <button onclick="saveToCloud()" id="sync-btn" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-4 rounded-2xl font-bold shadow-xl hover:opacity-90 transition-all active:scale-95 flex items-center justify-center gap-2 floating-button">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Save to Cloud</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Password Generator Modal -->
    <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card w-full max-w-md mx-4 p-6 rounded-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-800">Password Generator</h3>
                <button onclick="closePasswordModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-5">
                <div>
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-slate-700">Length: <span id="length-value">12</span></label>
                    </div>
                    <input type="range" id="password-length" min="8" max="32" value="12" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="updatePasswordLength()">
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-sm text-slate-700">Include Uppercase Letters</label>
                        <label class="switch">
                            <input type="checkbox" id="include-uppercase" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-sm text-slate-700">Include Lowercase Letters</label>
                        <label class="switch">
                            <input type="checkbox" id="include-lowercase" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-sm text-slate-700">Include Numbers</label>
                        <label class="switch">
                            <input type="checkbox" id="include-numbers" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-sm text-slate-700">Include Symbols</label>
                        <label class="switch">
                            <input type="checkbox" id="include-symbols" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="bg-slate-50 p-4 rounded-xl">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-medium text-slate-700">Generated Password</label>
                        <button onclick="copyGeneratedPassword()" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium">
                            <i class="fas fa-copy mr-1"></i>
                            Copy
                        </button>
                    </div>
                    <div class="flex">
                        <input type="text" id="generated-password" class="flex-1 p-3 rounded-l-lg border border-slate-200 font-mono text-sm" readonly>
                        <button onclick="regeneratePassword()" class="bg-indigo-100 text-indigo-700 p-3 rounded-r-lg hover:bg-indigo-200 transition">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <div class="text-xs text-slate-500">
                            Strength: <span id="generated-strength" class="font-medium">Strong</span>
                        </div>
                        <div class="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                            <div id="strength-bar" class="h-full bg-emerald-500 w-3/4"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3 pt-2">
                    <button onclick="useGeneratedPassword()" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:opacity-90 transition">
                        Use Password
                    </button>
                    <button onclick="closePasswordModal()" class="flex-1 bg-slate-100 text-slate-700 font-semibold py-3 rounded-xl hover:bg-slate-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- PWA SETUP ---
        const manifest = {
            "name": "ShieldVault",
            "short_name": "Vault",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#f8fafc",
            "theme_color": "#4f46e5",
            "icons": [{"src": "https://cdn-icons-png.flaticon.com/512/2092/2092663.png", "sizes": "512x512", "type": "image/png"}]
        };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        document.getElementById('manifest-link').setAttribute('href', URL.createObjectURL(blob));

        // --- CONFIG ---
        const WORKER_URL = "https://password-manager-api.sawyerbobk563.workers.dev"; 
        let vaultData = [];
        let notesData = [];
        let encryptionKey = null;
        let currentSalt = null;
        let filteredData = [];
        let filteredNotes = [];
        let isDarkTheme = false;
        let lastSyncTime = null;
        let isFirstLogin = false;
        let currentTab = 'passwords';
        
        // Inactivity tracking
        let inactivityTimer = null;
        let warningTimer = null;
        let logoutTimer = null;
        const WARNING_TIME = 60; // 1 minute warning
        const LOGOUT_TIME = 300; // 5 minutes total
        let timeLeft = LOGOUT_TIME;
        
        // Notification system
        let notificationId = 0;

        // Initialize theme
        function initializeTheme() {
            const savedTheme = localStorage.getItem('shieldvault-theme');
            isDarkTheme = savedTheme === 'dark';
            
            if (isDarkTheme) {
                document.body.classList.add('theme-dark');
                document.getElementById('theme-toggle').checked = true;
            }
        }
        
        // Toggle theme
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            
            if (isDarkTheme) {
                document.body.classList.add('theme-dark');
                localStorage.setItem('shieldvault-theme', 'dark');
            } else {
                document.body.classList.remove('theme-dark');
                localStorage.setItem('shieldvault-theme', 'light');
            }
        }

        // --- CRYPTO ---
        async function deriveKey(password, salt) {
            const encoder = new TextEncoder();
            const baseKey = await crypto.subtle.importKey("raw", encoder.encode(password), "PBKDF2", false, ["deriveKey"]);
            return await crypto.subtle.deriveKey({ name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" }, baseKey, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]);
        }

        async function encrypt(text, key) {
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const encoded = new TextEncoder().encode(text);
            const ciphertext = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, encoded);
            return { data: btoa(String.fromCharCode(...new Uint8Array(ciphertext))), iv: btoa(String.fromCharCode(...iv)) };
        }

        async function decrypt(encryptedObj, key) {
            try {
                const iv = new Uint8Array(atob(encryptedObj.iv).split("").map(c => c.charCodeAt(0)));
                const data = new Uint8Array(atob(encryptedObj.data).split("").map(c => c.charCodeAt(0)));
                const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, data);
                return new TextDecoder().decode(decrypted);
            } catch (e) { return null; }
        }

        // --- NOTIFICATION SYSTEM ---
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const id = `notification-${notificationId++}`;
            
            const notification = document.createElement('div');
            notification.id = id;
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="font-medium text-slate-800">${message}</div>
                    </div>
                    <button onclick="document.getElementById('${id}').remove()" class="text-slate-400 hover:text-slate-600 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto-remove after duration
            setTimeout(() => {
                const notif = document.getElementById(id);
                if (notif) {
                    notif.style.transform = 'translateX(100%)';
                    notif.style.opacity = '0';
                    setTimeout(() => notif.remove(), 300);
                }
            }, duration);
            
            return id;
        }

        // --- INACTIVITY LOGOUT SYSTEM ---
        function resetInactivityTimer() {
            if (document.getElementById('vault-section').classList.contains('hidden-vault')) {
                return; // Don't track if vault is locked
            }
            
            clearTimeout(inactivityTimer);
            clearTimeout(warningTimer);
            clearTimeout(logoutTimer);
            timeLeft = LOGOUT_TIME;
            
            updateInactivityDisplay();
            document.getElementById('logout-warning-modal').classList.add('hidden');
            
            // Set warning timer (4 minutes)
            warningTimer = setTimeout(() => {
                showLogoutWarning();
            }, (LOGOUT_TIME - WARNING_TIME) * 1000);
            
            // Set logout timer (5 minutes)
            logoutTimer = setTimeout(() => {
                forceLogout();
            }, LOGOUT_TIME * 1000);
            
            // Update display every second
            inactivityTimer = setInterval(() => {
                timeLeft--;
                updateInactivityDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(inactivityTimer);
                }
            }, 1000);
        }

        function updateInactivityDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('inactivity-timer').textContent = `Auto-logout: ${display}`;
        }

        function showLogoutWarning() {
            let countdown = WARNING_TIME;
            document.getElementById('countdown-timer').textContent = countdown;
            document.getElementById('logout-warning-modal').classList.remove('hidden');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('countdown-timer').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        function extendSession() {
            resetInactivityTimer();
            showNotification('Session extended for 5 minutes', 'success');
        }

        function confirmLogout() {
            if (confirm('Are you sure you want to log out now?')) {
                forceLogout();
            } else {
                extendSession();
            }
        }

        function forceLogout() {
            showNotification('You have been logged out due to inactivity', 'warning');
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        // Setup inactivity tracking
        function setupInactivityTracking() {
            ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer);
            });
            
            resetInactivityTimer();
        }

        // --- HAVE I BEEN PWNED CHECKER ---
        async function checkPwnedPassword() {
            const password = document.getElementById('pwned-password').value;
            
            if (!password) {
                showNotification('Please enter a password to check', 'warning');
                return;
            }
            
            const btn = document.getElementById('check-pwned-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Checking...';
            btn.disabled = true;
            
            try {
                // Hash the password using SHA-1
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-1', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                const hashPrefix = hashHex.substring(0, 5).toUpperCase();
                const hashSuffix = hashHex.substring(5).toUpperCase();
                
                // Make API call to Have I Been Pwned
                const response = await fetch(`https://api.pwnedpasswords.com/range/${hashPrefix}`, {
                    headers: {
                        'User-Agent': 'ShieldVault-Password-Checker'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to check password');
                }
                
                const dataText = await response.text();
                const lines = dataText.split('\n');
                let found = false;
                let count = 0;
                
                for (const line of lines) {
                    const [suffix, frequency] = line.split(':');
                    if (suffix.trim() === hashSuffix) {
                        found = true;
                        count = parseInt(frequency.trim());
                        break;
                    }
                }
                
                const resultDiv = document.getElementById('pwned-result');
                const resultContent = document.getElementById('pwned-result-content');
                
                if (found) {
                    resultContent.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-xl p-4">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-red-800">Password Compromised!</div>
                                    <div class="text-sm text-red-600">This password has appeared in ${count.toLocaleString()} data breaches</div>
                                </div>
                            </div>
                            <p class="text-sm text-red-700 mt-2">
                                <i class="fas fa-shield-alt mr-1"></i>
                                <strong>Recommendation:</strong> Change this password immediately. Use the password generator to create a new, unique password.
                            </p>
                            <button onclick="generatePassword()" class="w-full mt-3 bg-gradient-to-r from-red-500 to-orange-500 text-white font-semibold py-2.5 rounded-lg hover:opacity-90 transition">
                                <i class="fas fa-key mr-2"></i>Generate Secure Password
                            </button>
                        </div>
                    `;
                    showNotification('Password found in data breaches! Please change it immediately.', 'error');
                } else {
                    resultContent.innerHTML = `
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check-circle text-emerald-600"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-emerald-800">Password Not Found</div>
                                    <div class="text-sm text-emerald-600">Good news! This password hasn't been found in any known breaches</div>
                                </div>
                            </div>
                            <p class="text-sm text-emerald-700 mt-2">
                                <i class="fas fa-shield-alt mr-1"></i>
                                <strong>Note:</strong> This doesn't guarantee the password is secure. Always use strong, unique passwords.
                            </p>
                        </div>
                    `;
                    showNotification('Password not found in known breaches', 'success');
                }
                
                resultDiv.classList.remove('hidden');
                
            } catch (error) {
                showNotification('Failed to check password. Please try again.', 'error');
                console.error('Pwned check error:', error);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function openPwnedModal() {
            document.getElementById('pwned-modal').classList.remove('hidden');
            document.getElementById('pwned-password').focus();
        }

        function closePwnedModal() {
            document.getElementById('pwned-modal').classList.add('hidden');
            document.getElementById('pwned-password').value = '';
            document.getElementById('pwned-result').classList.add('hidden');
        }

        // --- SECURE NOTES SYSTEM ---
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.getElementById('tab-passwords').classList.remove('active');
            document.getElementById('tab-notes').classList.remove('active');
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // Update tab content
            document.getElementById('tab-content-passwords').classList.add('hidden');
            document.getElementById('tab-content-notes').classList.add('hidden');
            document.getElementById('tab-content-' + tabName).classList.remove('hidden');
            
            // Update floating button text
            const syncBtn = document.getElementById('sync-btn');
            if (tabName === 'notes') {
                syncBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i><span>Save Notes to Cloud</span>';
            } else {
                syncBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i><span>Save to Cloud</span>';
            }
        }

        function addNote() {
            const title = document.getElementById('new-note-title').value.trim();
            const content = document.getElementById('new-note-content').innerHTML.trim();
            const category = document.getElementById('new-note-category').value;
            
            if (!title) {
                showNotification('Please enter a note title', 'warning');
                document.getElementById('new-note-title').focus();
                return;
            }
            
            if (!content || content === '<br>') {
                showNotification('Please enter note content', 'warning');
                document.getElementById('new-note-content').focus();
                return;
            }
            
            notesData.push({
                id: Date.now(),
                title: title,
                content: content,
                category: category,
                created: new Date().toISOString(),
                updated: new Date().toISOString()
            });
            
            // Clear form
            document.getElementById('new-note-title').value = '';
            document.getElementById('new-note-content').innerHTML = '';
            document.getElementById('note-char-count').textContent = '0';
            
            // Render notes
            renderNotes();
            
            // Show success notification
            showNotification('Secure note added successfully', 'success');
            
            // Switch to notes tab if not already there
            if (currentTab !== 'notes') {
                switchTab('notes');
            }
        }

        function deleteNote(index) {
            if (confirm('Are you sure you want to delete this note?')) {
                notesData.splice(index, 1);
                renderNotes();
                showNotification('Note deleted', 'info');
            }
        }

        function editNote(index) {
            const note = notesData[index];
            document.getElementById('new-note-title').value = note.title;
            document.getElementById('new-note-content').innerHTML = note.content;
            document.getElementById('new-note-category').value = note.category;
            document.getElementById('note-char-count').textContent = note.content.replace(/<[^>]*>/g, '').length;
            
            // Remove note from list
            notesData.splice(index, 1);
            renderNotes();
            
            // Focus on title field
            document.getElementById('new-note-title').focus();
            
            showNotification('Note loaded for editing', 'info');
        }

        function renderNotes(data = notesData) {
            const list = document.getElementById('notes-list');
            
            if (data.length === 0) {
                list.innerHTML = '';
                document.getElementById('empty-notes-state').classList.remove('hidden');
                updateNotesStats();
                return;
            }
            
            document.getElementById('empty-notes-state').classList.add('hidden');
            
            list.innerHTML = data.map((note, i) => {
                const createdDate = new Date(note.created);
                const updatedDate = new Date(note.updated);
                const isUpdated = updatedDate.getTime() - createdDate.getTime() > 60000; // More than 1 minute difference
                const dateDisplay = isUpdated ? 
                    `Updated: ${updatedDate.toLocaleDateString()}` : 
                    `Created: ${createdDate.toLocaleDateString()}`;
                
                // Truncate content for preview
                const textContent = note.content.replace(/<[^>]*>/g, '').substring(0, 150);
                const preview = textContent.length < note.content.replace(/<[^>]*>/g, '').length ? 
                    textContent + '...' : textContent;
                
                return `
                <div class="entry-card glass-card p-5 rounded-2xl slide-up">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="text-sm font-bold text-slate-800 truncate">${note.title}</div>
                                    <span class="text-xs px-2 py-0.5 rounded-full ${getNoteCategoryColor(note.category)} flex-shrink-0">${note.category}</span>
                                </div>
                                <div class="flex gap-1">
                                    <button onclick="editNote(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition" title="Edit Note">
                                        <i class="fas fa-edit text-sm"></i>
                                    </button>
                                    <button onclick="copyNoteContent(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition" title="Copy Note">
                                        <i class="fas fa-copy text-sm"></i>
                                    </button>
                                    <button onclick="deleteNote(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-red-50 text-red-400 hover:bg-red-100 hover:text-red-600 transition" title="Delete Note">
                                        <i class="fas fa-trash-alt text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-sm text-slate-600 mb-3 line-clamp-2">${preview}</div>
                            <div class="flex justify-between items-center">
                                <div class="text-xs text-slate-400">
                                    <i class="far fa-clock mr-1"></i>
                                    ${dateDisplay}
                                </div>
                                <div class="text-xs text-slate-400">
                                    ${note.content.replace(/<[^>]*>/g, '').length} chars
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            updateNotesStats();
        }

        function getNoteCategoryColor(category) {
            const colors = {
                'Personal': 'bg-pink-100 text-pink-800',
                'Work': 'bg-purple-100 text-purple-800',
                'Finance': 'bg-emerald-100 text-emerald-800',
                'Ideas': 'bg-amber-100 text-amber-800',
                'Credentials': 'bg-red-100 text-red-800',
                'Other': 'bg-slate-100 text-slate-800'
            };
            return colors[category] || 'bg-slate-100 text-slate-800';
        }

        function copyNoteContent(index) {
            const note = notesData[index];
            const textContent = note.content.replace(/<[^>]*>/g, '');
            navigator.clipboard.writeText(`${note.title}\n\n${textContent}`).then(() => {
                showNotification('Note copied to clipboard', 'success');
            });
        }

        function searchNotes() {
            const searchTerm = document.getElementById('search-notes-input').value.toLowerCase();
            const clearButton = document.getElementById('clear-notes-search');
            
            if (searchTerm) {
                clearButton.classList.remove('hidden');
                filteredNotes = notesData.filter(note => 
                    note.title.toLowerCase().includes(searchTerm) || 
                    note.content.toLowerCase().includes(searchTerm) ||
                    note.category.toLowerCase().includes(searchTerm)
                );
                renderNotes(filteredNotes);
            } else {
                clearButton.classList.add('hidden');
                filteredNotes = [];
                renderNotes(notesData);
            }
            
            updateNotesStats(filteredNotes.length > 0 ? filteredNotes : notesData);
        }

        function clearNotesSearch() {
            document.getElementById('search-notes-input').value = '';
            document.getElementById('clear-notes-search').classList.add('hidden');
            filteredNotes = [];
            renderNotes(notesData);
        }

        function sortNotes(criteria) {
            const data = filteredNotes.length > 0 ? filteredNotes : notesData;
            
            data.sort((a, b) => {
                switch(criteria) {
                    case 'title-asc':
                        return a.title.localeCompare(b.title);
                    case 'title-desc':
                        return b.title.localeCompare(a.title);
                    case 'date-desc':
                        return new Date(b.updated || b.created) - new Date(a.updated || a.created);
                    case 'date-asc':
                        return new Date(a.updated || a.created) - new Date(b.updated || b.created);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    default:
                        return new Date(b.updated || b.created) - new Date(a.updated || a.created);
                }
            });
            
            renderNotes(data);
        }

        function updateNotesStats(data = notesData) {
            const showing = filteredNotes.length > 0 ? filteredNotes.length : notesData.length;
            document.getElementById('showing-notes-count').textContent = showing;
            document.getElementById('total-notes-count').textContent = notesData.length;
            document.getElementById('notes-count').textContent = notesData.length;
            
            // Calculate statistics
            const totalChars = data.reduce((sum, note) => sum + note.content.replace(/<[^>]*>/g, '').length, 0);
            document.getElementById('stats-notes-total').textContent = data.length;
            document.getElementById('stats-notes-chars').textContent = totalChars.toLocaleString();
            
            // Calculate categories
            const categoryCounts = {};
            data.forEach(note => {
                categoryCounts[note.category] = (categoryCounts[note.category] || 0) + 1;
            });
            
            const categoriesDiv = document.getElementById('notes-categories');
            categoriesDiv.innerHTML = Object.entries(categoryCounts)
                .map(([category, count]) => `
                    <span class="text-xs px-2 py-1 rounded-full ${getNoteCategoryColor(category)}">
                        ${category}: ${count}
                    </span>
                `).join('');
                
            // Update note character count in real-time
            const noteContent = document.getElementById('new-note-content');
            noteContent.addEventListener('input', function() {
                const text = this.innerText || '';
                document.getElementById('note-char-count').textContent = text.length;
            });
        }

        // --- ENHANCED PASSWORD STRENGTH CHECKER ---
        function checkPasswordStrength(password) {
            if (!password) return { text: "None", score: 0 };
            
            let score = 0;
            let criteria = {
                length: false,
                uppercase: false,
                lowercase: false,
                numbers: false,
                special: false
            };
            
            // Length check
            if (password.length >= 8) score += 1;
            if (password.length >= 12) { score += 1; criteria.length = true; }
            
            // Character type checks
            if (/[A-Z]/.test(password)) { score += 1; criteria.uppercase = true; }
            if (/[a-z]/.test(password)) { score += 1; criteria.lowercase = true; }
            if (/[0-9]/.test(password)) { score += 1; criteria.numbers = true; }
            if (/[^A-Za-z0-9]/.test(password)) { score += 1; criteria.special = true; }
            
            // Bonus for mixed character types and length
            if (criteria.uppercase && criteria.lowercase && criteria.numbers && criteria.special) score += 1;
            if (password.length >= 16) score += 1;
            
            const strengthMap = [
                { text: "Very Weak", color: "text-red-500", score: 0 },
                { text: "Weak", color: "text-orange-500", score: 1 },
                { text: "Fair", color: "text-yellow-500", score: 2 },
                { text: "Good", color: "text-lime-500", score: 3 },
                { text: "Strong", color: "text-emerald-500", score: 4 },
                { text: "Very Strong", color: "text-green-600", score: 5 },
                { text: "Excellent", color: "text-green-700", score: 6 }
            ];
            
            return {
                ...strengthMap[Math.min(score, strengthMap.length - 1)],
                criteria: criteria,
                score: score
            };
        }

        // --- UPDATE PASSWORD CRITERIA DISPLAY ---
        function updatePasswordCriteria(password) {
            const criteria = document.getElementById('password-criteria');
            const strength = checkPasswordStrength(password);
            
            if (password.length > 0) {
                criteria.classList.remove('hidden');
                document.getElementById('criteria-length').textContent = strength.criteria.length ? '✓' : '✗';
                document.getElementById('criteria-length').className = strength.criteria.length ? 'text-emerald-500' : 'text-red-500';
                
                document.getElementById('criteria-uppercase').textContent = strength.criteria.uppercase ? '✓' : '✗';
                document.getElementById('criteria-uppercase').className = strength.criteria.uppercase ? 'text-emerald-500' : 'text-red-500';
                
                document.getElementById('criteria-lowercase').textContent = strength.criteria.lowercase ? '✓' : '✗';
                document.getElementById('criteria-lowercase').className = strength.criteria.lowercase ? 'text-emerald-500' : 'text-red-500';
                
                document.getElementById('criteria-numbers').textContent = strength.criteria.numbers ? '✓' : '✗';
                document.getElementById('criteria-numbers').className = strength.criteria.numbers ? 'text-emerald-500' : 'text-red-500';
                
                document.getElementById('criteria-special').textContent = strength.criteria.special ? '✓' : '✗';
                document.getElementById('criteria-special').className = strength.criteria.special ? 'text-emerald-500' : 'text-red-500';
            } else {
                criteria.classList.add('hidden');
            }
        }

        // --- CALCULATE ENHANCED STATISTICS ---
        function calculateEnhancedStats() {
            let strongCount = 0;
            let weakCount = 0;
            let shortCount = 0;
            const now = new Date();
            let totalAgeDays = 0;
            const passwordMap = {};
            let duplicateCount = 0;
            
            vaultData.forEach(entry => {
                const strength = checkPasswordStrength(entry.pass);
                if (strength.score >= 4) {
                    strongCount++;
                } else if (strength.score <= 2) {
                    weakCount++;
                }
                
                if (entry.pass.length < 12) {
                    shortCount++;
                }
                
                // Calculate password age
                if (entry.created) {
                    const createdDate = new Date(entry.created);
                    const ageDays = Math.floor((now - createdDate) / (1000 * 60 * 60 * 24));
                    totalAgeDays += ageDays;
                }
                
                // Check for password reuse
                if (passwordMap[entry.pass]) {
                    passwordMap[entry.pass]++;
                    duplicateCount++;
                } else {
                    passwordMap[entry.pass] = 1;
                }
            });
            
            const avgAge = vaultData.length > 0 ? Math.floor(totalAgeDays / vaultData.length) : 0;
            
            // Update UI
            document.getElementById('stats-strong').textContent = strongCount;
            document.getElementById('stats-weak').textContent = weakCount;
            document.getElementById('stats-age').textContent = `${avgAge} days`;
            document.getElementById('stats-reuse').textContent = duplicateCount;
            document.getElementById('stats-short').textContent = shortCount;
        }

        // --- PASSWORD GENERATOR ---
        function generateRandomPassword(length = 12, options = {
            uppercase: true,
            lowercase: true,
            numbers: true,
            symbols: true
        }) {
            const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const lowercase = "abcdefghijklmnopqrstuvwxyz";
            const numbers = "0123456789";
            const symbols = "!@#$%^&*()_+-=[]{}|;:,.<>?";
            
            let chars = "";
            if (options.uppercase) chars += uppercase;
            if (options.lowercase) chars += lowercase;
            if (options.numbers) chars += numbers;
            if (options.symbols) chars += symbols;
            
            // Ensure at least one character from each selected set
            let password = "";
            if (options.uppercase) password += uppercase.charAt(Math.floor(Math.random() * uppercase.length));
            if (options.lowercase) password += lowercase.charAt(Math.floor(Math.random() * lowercase.length));
            if (options.numbers) password += numbers.charAt(Math.floor(Math.random() * numbers.length));
            if (options.symbols) password += symbols.charAt(Math.floor(Math.random() * symbols.length));
            
            // Fill the rest with random characters
            for (let i = password.length; i < length; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Shuffle the password
            return password.split('').sort(() => Math.random() - 0.5).join('');
        }

        // --- PASSWORD VISIBILITY TOGGLE ---
        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.parentNode.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // --- SUGGEST PASSWORD ---
        function suggestPassword() {
            const password = generateRandomPassword(14, {
                uppercase: true,
                lowercase: true,
                numbers: true,
                symbols: true
            });
            
            document.getElementById('new-pass').value = password;
            
            // Update strength indicator
            const strength = checkPasswordStrength(password);
            document.getElementById('password-strength').textContent = strength.text;
            document.getElementById('password-strength').className = `font-medium ${strength.color}`;
            
            // Update criteria display
            updatePasswordCriteria(password);
        }

        // --- TUTORIAL FUNCTIONS ---
        function showTutorial() {
            const dontShowAgain = localStorage.getItem('shieldvault-no-tutorial');
            if (!dontShowAgain && isFirstLogin) {
                document.getElementById('tutorial-modal').classList.remove('hidden');
            }
        }

        function closeTutorial() {
            document.getElementById('tutorial-modal').classList.add('hidden');
            const dontShowAgain = document.getElementById('dont-show-again').checked;
            if (dontShowAgain) {
                localStorage.setItem('shieldvault-no-tutorial', 'true');
            }
            
            // Highlight the add password form
            document.getElementById('new-site').classList.add('highlight');
            setTimeout(() => {
                document.getElementById('new-site').classList.remove('highlight');
            }, 2000);
        }

        // --- INFO MODAL FUNCTIONS ---
        function showInfoModal() {
            document.getElementById('info-modal').classList.remove('hidden');
        }

        function closeInfoModal() {
            document.getElementById('info-modal').classList.add('hidden');
        }

        // --- CONFIRM LOCK VAULT ---
        function confirmLockVault() {
            if (confirm("Are you sure you want to lock the vault? You'll need to enter your master password again to access it.")) {
                location.reload();
            }
        }

        // --- UPDATE LAST SYNC TIME ---
        function updateLastSyncTime() {
            const now = new Date();
            lastSyncTime = now;
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateString = now.toLocaleDateString();
            const displayString = `${dateString} at ${timeString}`;
            
            document.getElementById('last-sync-time').textContent = displayString;
            document.getElementById('last-sync-bottom').textContent = displayString;
            document.getElementById('sync-status-indicator').className = 'w-2 h-2 bg-emerald-500 rounded-full ml-1';
            
            localStorage.setItem(`shieldvault-lastsync-${document.getElementById('username').value.trim()}`, now.toISOString());
        }

        // --- ACTIONS ---
        async function unlockVault() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('master-password').value;
            
            if (!user || !pass) {
                document.getElementById('auth-section').classList.add('shake');
                setTimeout(() => document.getElementById('auth-section').classList.remove('shake'), 500);
                showNotification('Please enter both vault name and password', 'warning');
                return;
            }
            
            const btn = document.getElementById('unlock-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Connecting...</span>';
            btn.disabled = true;

            try {
                const resp = await fetch(`${WORKER_URL}/get?user=${encodeURIComponent(user)}`);
                const cloudData = await resp.json();
                
                currentSalt = (cloudData && cloudData.salt) ? new Uint8Array(atob(cloudData.salt).split("").map(c => c.charCodeAt(0))) : crypto.getRandomValues(new Uint8Array(16));
                encryptionKey = await deriveKey(pass, currentSalt);

                if (cloudData && cloudData.vault) {
                    const decrypted = await decrypt(cloudData.vault, encryptionKey);
                    if (decrypted === null) throw new Error("Wrong Master Password.");
                    const parsedData = JSON.parse(decrypted);
                    vaultData = parsedData.passwords || [];
                    notesData = parsedData.notes || [];
                    isFirstLogin = false;
                } else {
                    vaultData = [];
                    notesData = [];
                    isFirstLogin = true;
                }
                
                showVault(user);
                showNotification('Vault unlocked successfully', 'success');
                
                // Check for last sync time
                const lastSync = localStorage.getItem(`shieldvault-lastsync-${user}`);
                if (lastSync) {
                    const lastSyncDate = new Date(lastSync);
                    const timeString = lastSyncDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const dateString = lastSyncDate.toLocaleDateString();
                    const displayString = `${dateString} at ${timeString}`;
                    
                    document.getElementById('last-sync-time').textContent = displayString;
                    document.getElementById('last-sync-bottom').textContent = displayString;
                }
                
                // Setup inactivity tracking
                setupInactivityTracking();
                
                // Show tutorial if first login
                setTimeout(() => {
                    if (isFirstLogin) {
                        showTutorial();
                    }
                }, 500);
                
            } catch (err) {
                showNotification(err.message || 'Failed to unlock vault. Please check your credentials.', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function showVault(user) {
            document.getElementById('auth-section').classList.add('hidden-vault');
            document.getElementById('vault-section').classList.remove('hidden-vault');
            document.getElementById('display-user').innerText = user;
            renderEntries();
            renderNotes();
            
            // Show info button
            document.getElementById('info-button').classList.remove('hidden');
        }

        function updateStats() {
            document.getElementById('entry-count').textContent = vaultData.length;
            
            // Update showing counts
            const showing = filteredData.length > 0 ? filteredData.length : vaultData.length;
            document.getElementById('showing-count').textContent = showing;
            document.getElementById('total-count').textContent = vaultData.length;
            
            // Calculate enhanced statistics
            calculateEnhancedStats();
            
            // Show/hide empty state
            document.getElementById('empty-state').style.display = vaultData.length === 0 ? 'block' : 'none';
        }

        function renderEntries(data = vaultData) {
            const list = document.getElementById('entries-list');
            
            if (data.length === 0) {
                list.innerHTML = '';
                document.getElementById('empty-state').style.display = 'block';
                updateStats();
                return;
            }
            
            document.getElementById('empty-state').style.display = 'none';
            
            list.innerHTML = data.map((item, i) => {
                const strength = checkPasswordStrength(item.pass);
                const categoryIcon = getCategoryIcon(item.category);
                const createdDate = item.created ? new Date(item.created) : new Date();
                const ageDays = Math.floor((new Date() - createdDate) / (1000 * 60 * 60 * 24));
                const ageText = ageDays === 0 ? 'Today' : ageDays === 1 ? '1 day ago' : `${ageDays} days ago`;
                
                return `
                <div class="entry-card glass-card p-5 rounded-2xl slide-up">
                    <div class="flex justify-between items-start">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                <i class="${categoryIcon} text-indigo-600"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <div class="text-sm font-bold text-slate-800 truncate">${item.site || 'Unnamed'}</div>
                                    <span class="text-xs px-2 py-0.5 rounded-full ${getCategoryColor(item.category)} flex-shrink-0">${item.category || 'General'}</span>
                                </div>
                                <div class="text-sm text-slate-600 truncate">
                                    <i class="fas fa-user mr-1 text-slate-400"></i>
                                    ${item.user || 'No username'}
                                </div>
                                <div class="mt-3 flex items-center gap-2">
                                    <div class="font-mono text-sm bg-slate-100 px-3 py-1.5 rounded-lg select-all password-mask">${'•'.repeat(item.pass.length)}</div>
                                    <div class="flex gap-1">
                                        <button onclick="copyPassword(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition" title="Copy Password">
                                            <i class="fas fa-copy text-sm"></i>
                                        </button>
                                        <button onclick="revealPassword(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition" title="Reveal Password">
                                            <i class="fas fa-eye text-sm"></i>
                                        </button>
                                        <button onclick="removeEntry(${i})" class="w-8 h-8 flex items-center justify-center rounded-lg bg-red-50 text-red-400 hover:bg-red-100 hover:text-red-600 transition" title="Delete">
                                            <i class="fas fa-trash-alt text-sm"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="mt-2 flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <div class="text-xs text-slate-400">Strength:</div>
                                        <div class="text-xs font-medium ${strength.color}">${strength.text}</div>
                                        <div class="w-16 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                                            <div class="h-full ${strength.color.replace('text-', 'bg-')}" style="width: ${(strength.score + 1) * 14}%"></div>
                                        </div>
                                    </div>
                                    <div class="text-xs text-slate-400" title="${createdDate.toLocaleString()}">
                                        Added: ${ageText}
                                    </div>
                                </div>
                                ${item.pass.length < 12 ? `
                                <div class="mt-2 text-xs text-red-500 flex items-center gap-1">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Password is too short (${item.pass.length} chars)
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            updateStats();
        }

        function getCategoryIcon(category) {
            const icons = {
                'Social': 'fas fa-users',
                'Finance': 'fas fa-piggy-bank',
                'Work': 'fas fa-briefcase',
                'Shopping': 'fas fa-shopping-cart',
                'Entertainment': 'fas fa-film',
                'General': 'fas fa-globe'
            };
            return icons[category] || 'fas fa-globe';
        }

        function getCategoryColor(category) {
            const colors = {
                'Social': 'bg-blue-100 text-blue-800',
                'Finance': 'bg-emerald-100 text-emerald-800',
                'Work': 'bg-purple-100 text-purple-800',
                'Shopping': 'bg-amber-100 text-amber-800',
                'Entertainment': 'bg-pink-100 text-pink-800',
                'General': 'bg-slate-100 text-slate-800'
            };
            return colors[category] || 'bg-slate-100 text-slate-800';
        }

        function addEntry() {
            const site = document.getElementById('new-site');
            const user = document.getElementById('new-user');
            const pass = document.getElementById('new-pass');
            const category = document.getElementById('new-category');
            
            if (!site.value || !pass.value) {
                showNotification('Please enter at least a website and password', 'warning');
                return;
            }
            
            vaultData.push({ 
                site: site.value, 
                user: user.value || "", 
                pass: pass.value,
                category: category.value,
                created: new Date().toISOString()
            });
            
            site.value = ''; 
            user.value = ''; 
            pass.value = '';
            
            renderEntries();
            
            // Clear search if active
            document.getElementById('search-input').value = '';
            document.getElementById('clear-search').classList.add('hidden');
            filteredData = [];
            
            // Hide password criteria
            document.getElementById('password-criteria').classList.add('hidden');
            
            // Show success notification
            showNotification('Password added successfully', 'success');
        }

        function removeEntry(i) {
            if(confirm("Are you sure you want to delete this password entry?")) {
                vaultData.splice(i, 1);
                renderEntries();
                showNotification('Password deleted', 'info');
            }
        }

        // --- COPY PASSWORD ---
        function copyPassword(i) {
            const data = filteredData.length > 0 ? filteredData : vaultData;
            const password = data[i].pass;
            navigator.clipboard.writeText(password).then(() => {
                showNotification('Password copied to clipboard', 'success');
            });
        }

        // --- REVEAL PASSWORD ---
        function revealPassword(i) {
            const data = filteredData.length > 0 ? filteredData : vaultData;
            const entryCards = document.querySelectorAll('.entry-card');
            const passwordElement = entryCards[i].querySelector('.password-mask');
            
            if (passwordElement.textContent.includes('•')) {
                passwordElement.textContent = data[i].pass;
                setTimeout(() => {
                    passwordElement.textContent = '•'.repeat(data[i].pass.length);
                }, 3000);
            }
        }

        // --- SEARCH FUNCTIONALITY ---
        function searchEntries() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const clearButton = document.getElementById('clear-search');
            
            if (searchTerm) {
                clearButton.classList.remove('hidden');
                filteredData = vaultData.filter(entry => 
                    entry.site.toLowerCase().includes(searchTerm) || 
                    entry.user.toLowerCase().includes(searchTerm) ||
                    (entry.category && entry.category.toLowerCase().includes(searchTerm))
                );
                renderEntries(filteredData);
            } else {
                clearButton.classList.add('hidden');
                filteredData = [];
                renderEntries(vaultData);
            }
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('clear-search').classList.add('hidden');
            filteredData = [];
            renderEntries(vaultData);
        }

        // --- ENHANCED SORT FUNCTIONALITY ---
        function sortEntries(criteria) {
            const data = filteredData.length > 0 ? filteredData : vaultData;
            
            data.sort((a, b) => {
                switch(criteria) {
                    case 'site-asc':
                        return a.site.localeCompare(b.site);
                    case 'site-desc':
                        return b.site.localeCompare(a.site);
                    case 'category':
                        return (a.category || 'General').localeCompare(b.category || 'General');
                    case 'strength':
                        const strengthA = checkPasswordStrength(a.pass).score;
                        const strengthB = checkPasswordStrength(b.pass).score;
                        return strengthB - strengthA; // Strongest first
                    case 'recent':
                        const dateA = a.created ? new Date(a.created) : new Date(0);
                        const dateB = b.created ? new Date(b.created) : new Date(0);
                        return dateB - dateA; // Most recent first
                    case 'oldest':
                        const dateA2 = a.created ? new Date(a.created) : new Date(0);
                        const dateB2 = b.created ? new Date(b.created) : new Date(0);
                        return dateA2 - dateB2; // Oldest first
                    default:
                        return a.site.localeCompare(b.site);
                }
            });
            
            renderEntries(data);
        }

        // --- EXPORT / IMPORT LOGIC ---
        function exportVault(format) {
            const data = filteredData.length > 0 ? filteredData : vaultData;
            const timestamp = new Date().toISOString().split('T')[0];
            
            if (format === 'json') {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `shieldvault_backup_${timestamp}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                
                showNotification('Vault exported as JSON successfully', 'success');
            } else if (format === 'csv') {
                // Convert to CSV
                const headers = ['Website', 'Category', 'Username', 'Password', 'Created'];
                const csvRows = [];
                
                // Add headers
                csvRows.push(headers.join(','));
                
                // Add data rows
                data.forEach(entry => {
                    const row = [
                        `"${entry.site.replace(/"/g, '""')}"`,
                        `"${(entry.category || 'General').replace(/"/g, '""')}"`,
                        `"${(entry.user || '').replace(/"/g, '""')}"`,
                        `"${entry.pass.replace(/"/g, '""')}"`,
                        `"${entry.created || new Date().toISOString()}"`
                    ];
                    csvRows.push(row.join(','));
                });
                
                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', `shieldvault_backup_${timestamp}.csv`);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showNotification('Vault exported as CSV successfully', 'success');
            }
        }

        function importVault(event, format) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm("Importing will merge passwords with your current vault. Continue?")) {
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let imported = [];
                    
                    if (format === 'json') {
                        imported = JSON.parse(e.target.result);
                        if (!Array.isArray(imported)) {
                            throw new Error("Invalid JSON format");
                        }
                    } else if (format === 'csv') {
                        const csvText = e.target.result;
                        const lines = csvText.split('\n');
                        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim() === '') continue;
                            
                            const values = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.replace(/^"|"$/g, ''));
                            
                            const entry = {
                                site: values[0] || '',
                                category: values[1] || 'General',
                                user: values[2] || '',
                                pass: values[3] || '',
                                created: values[4] || new Date().toISOString()
                            };
                            
                            imported.push(entry);
                        }
                    }
                    
                    // Merge with current vault, avoiding duplicates
                    const existingSites = new Set(vaultData.map(entry => `${entry.site}|${entry.user}`));
                    const newEntries = imported.filter(entry => !existingSites.has(`${entry.site}|${entry.user}`));
                    
                    vaultData = [...vaultData, ...newEntries];
                    renderEntries();
                    showNotification(`${newEntries.length} new passwords imported! Don't forget to click Save to Cloud.`, 'success');
                    
                } catch (err) {
                    showNotification(`Invalid ${format.toUpperCase()} file. Please check the file format.`, 'error');
                }
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        // --- CLOUD SYNC ---
        async function saveToCloud() {
            const btn = document.getElementById('sync-btn');
            const user = document.getElementById('username').value.trim();
            
            if (!user) {
                showNotification('Please enter a vault name first', 'warning');
                return;
            }
            
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Syncing...</span>';
            btn.disabled = true;
            
            try {
                const vaultToSave = {
                    passwords: vaultData,
                    notes: notesData
                };
                
                const encrypted = await encrypt(JSON.stringify(vaultToSave), encryptionKey);
                const saltString = btoa(String.fromCharCode(...currentSalt));
                const resp = await fetch(`${WORKER_URL}/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user, salt: saltString, vault: encrypted })
                });
                
                if (resp.ok) {
                    btn.innerHTML = '<i class="fas fa-check"></i><span>Synced Successfully</span>';
                    btn.classList.remove('from-emerald-500', 'to-teal-500');
                    btn.classList.add('from-green-500', 'to-emerald-500');
                    
                    updateLastSyncTime();
                    showNotification('Data saved to cloud successfully', 'success');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('from-green-500', 'to-emerald-500');
                        btn.classList.add('from-emerald-500', 'to-teal-500');
                    }, 2000);
                } else {
                    throw new Error("Server responded with an error");
                }
            } catch (err) {
                showNotification("Sync failed: " + err.message, 'error');
                btn.innerHTML = originalText;
                document.getElementById('sync-status-indicator').className = 'w-2 h-2 bg-red-500 rounded-full ml-1';
            } finally {
                btn.disabled = false;
            }
        }

        // --- PASSWORD GENERATOR MODAL ---
        function generatePassword() {
            // Generate initial password
            regeneratePassword();
            
            // Show modal
            document.getElementById('password-modal').classList.remove('hidden');
        }

        function closePasswordModal() {
            document.getElementById('password-modal').classList.add('hidden');
        }

        function updatePasswordLength() {
            const length = document.getElementById('password-length').value;
            document.getElementById('length-value').textContent = length;
            regeneratePassword();
        }

        function regeneratePassword() {
            const length = parseInt(document.getElementById('password-length').value);
            const includeUppercase = document.getElementById('include-uppercase').checked;
            const includeLowercase = document.getElementById('include-lowercase').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSymbols = document.getElementById('include-symbols').checked;
            
            const password = generateRandomPassword(length, {
                uppercase: includeUppercase,
                lowercase: includeLowercase,
                numbers: includeNumbers,
                symbols: includeSymbols
            });
            
            document.getElementById('generated-password').value = password;
            
            // Update strength indicator
            const strength = checkPasswordStrength(password);
            document.getElementById('generated-strength').textContent = strength.text;
            document.getElementById('generated-strength').className = `font-medium ${strength.color}`;
            
            // Update strength bar
            const strengthBar = document.getElementById('strength-bar');
            strengthBar.className = `h-full ${strength.color.replace('text-', 'bg-')}`;
            strengthBar.style.width = `${(strength.score + 1) * 14}%`;
        }

        function copyGeneratedPassword() {
            const password = document.getElementById('generated-password').value;
            navigator.clipboard.writeText(password).then(() => {
                showNotification('Password copied to clipboard', 'success');
            });
        }

        function useGeneratedPassword() {
            document.getElementById('new-pass').value = document.getElementById('generated-password').value;
            
            // Update strength indicator
            const strength = checkPasswordStrength(document.getElementById('generated-password').value);
            document.getElementById('password-strength').textContent = strength.text;
            document.getElementById('password-strength').className = `font-medium ${strength.color}`;
            
            // Update criteria display
            updatePasswordCriteria(document.getElementById('generated-password').value);
            
            closePasswordModal();
            showNotification('Generated password applied to form', 'info');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            
            // Update password strength in real-time
            const newPassInput = document.getElementById('new-pass');
            newPassInput.addEventListener('input', function() {
                const strength = checkPasswordStrength(this.value);
                document.getElementById('password-strength').textContent = strength.text;
                document.getElementById('password-strength').className = `font-medium ${strength.color}`;
                updatePasswordCriteria(this.value);
            });
            
            // Auto-generate initial password for modal
            regeneratePassword();
            
            // Set sync status indicator
            document.getElementById('sync-status-indicator').className = 'w-2 h-2 bg-slate-300 rounded-full ml-1';
            
            // Setup note character counter
            const noteContent = document.getElementById('new-note-content');
            noteContent.addEventListener('input', function() {
                const text = this.innerText || '';
                document.getElementById('note-char-count').textContent = text.length;
            });
            
            // Set placeholder for note editor
            noteContent.addEventListener('focus', function() {
                if (this.innerHTML === '') {
                    this.innerHTML = '';
                }
            });
            
            noteContent.addEventListener('blur', function() {
                if (this.innerHTML === '') {
                    this.innerHTML = '';
                }
            });
        });
    </script>
</body>
</html>
